'use strict';var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_path=require('path'),_path2=_interopRequireDefault(_path),_fs=require('fs'),_toCamelCase=require('to-camel-case'),_toCamelCase2=_interopRequireDefault(_toCamelCase),_whiteList=require('./white-list.js'),_whiteList2=_interopRequireDefault(_whiteList),_packageList=require('./package-list.js'),_packageList2=_interopRequireDefault(_packageList),_deepmerge=require('deepmerge'),_deepmerge2=_interopRequireDefault(_deepmerge);Object.defineProperty(exports,'__esModule',{value:!0});function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}exports.default=new(function(){function a(){_classCallCheck(this,a),this.cwd=process.cwd(),this.pkg=require(_path2.default.join(this.cwd,'package.json')),this.nodeModules=(0,_fs.existsSync)(_path2.default.join(this.cwd,'node_modules'))?(0,_fs.readdirSync)(_path2.default.join(this.cwd,'node_modules')):{},this.list=[].concat(_toConsumableArray(new Set([].concat(_toConsumableArray(this.nodeModules),_toConsumableArray(Object.keys(this.pkg).filter(function(b){return -1===_packageList2.default.indexOf(b)})),_toConsumableArray(Object.keys(Object.assign(this.pkg.dependencies||{},this.pkg.devDependencies||{}))))))),this.namespaces=[].concat(_toConsumableArray(new Set(this.list.map(this.getNamespace).filter(function(b){return b.length}))))}return _createClass(a,[{key:'find',value:function find(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:'';return this.list.find(function(d){return'0'===b||'1'===b?!1:-1!==(0,_toCamelCase2.default)(d).toLowerCase().indexOf((0,_toCamelCase2.default)(`${-1===b.indexOf(c)?c:''}${b}`).toLowerCase())})}},{key:'getNamespace',value:function getNamespace(b){for(var c in _whiteList2.default)if(-1!==_whiteList2.default[c].indexOf(b))return c;return-1===b.indexOf('-')?b:b.substr(0,b.indexOf('-'))}},{key:'configExtends',value:function configExtends(b){var c=this;return b.forEach(function(){var d=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(Array.isArray(d))throw new TypeError('config extends must not be an Array');'string'==typeof d&&(0,_fs.existsSync)(_path2.default.resolve(d))&&(d=require(_path2.default.resolve(c.cwd,d))),c.namespaces.filter(function(e){return Reflect.has(d,e)}).forEach(function(e){Reflect.has(c.pkg,e)||(c.pkg[e]={}),c.pkg[e]=(0,_deepmerge2.default)(c.pkg[e],d[e]),Reflect.deleteProperty(d,e)}),Reflect.has(d,'plugins')&&(d=(0,_deepmerge2.default)(d,d.plugins),Reflect.deleteProperty(d,'plugins')),Object.keys(d).forEach(function(e){var f=-1===c.namespaces.indexOf(c.getNamespace(e))?void 0:c.getNamespace(e),g=c.find(e,f);void 0===g&&-1!==c.namespaces.indexOf(f)&&-1!==c.list.indexOf(e)&&-1!==_whiteList2.default[f].indexOf(e)&&(c.pkg[f]=(0,_deepmerge2.default)(c.pkg[f],{[e]:d[e]||{}}),Reflect.deleteProperty(d,e)),-1!==c.list.indexOf(g)&&-1!==c.namespaces.indexOf(f=c.getNamespace(g))&&(c.pkg[f]=(0,_deepmerge2.default)(c.pkg[f],{[e]:d[e]||{}}),Reflect.deleteProperty(d,e))})}),this}}]),a}()),module.exports=exports['default'];